<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <title>Shop</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Raleway:wght@600;800&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">


    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">

    <style>
        .toast-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1055;
        }
        .custom-toast {
            min-width: 400px;
            max-width: 500px;
            background-color: #d4edda;
            color: #155724;
            font-size: 1.25rem;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            opacity: 1;
            transition: opacity 0.8s ease-in-out;
        }
        .fade-out {
            opacity: 0;
        }
        .hidden {
            display: none;
        }
        .custom-toast .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #155724;
        }

        .price-filter-link {
            display: inline-block;
            margin-bottom: 10px;
        }
        .btn-filter {
            width: fit-content;
            padding: 0.5rem 1rem;
            background-color: #28a745;
            color: white;
        }

        .btn-filter:hover {
            background-color: #218838;
            color: white;
        }

        .sort-dropdown-container {
            position: relative;
            float: right;
            margin-bottom: 20px;
            z-index: 1000;
        }

        .active-category {
            color: #ffb524;
            font-weight: bold;
        }

        .active-price-filter {
            color: #81c408 !important; /* The green color you want */
            font-weight: bold; /* Optional: to make it stand out more */
        }

        .price-filter-link {
            color: #6c757d; /* Default text-muted color */
        }

    </style>
</head>

<body>
<!-- Spinner Start -->
<div id="spinner" class="show w-100 vh-100 bg-white position-fixed translate-middle top-50 start-50  d-flex align-items-center justify-content-center">
    <div class="spinner-grow text-primary" role="status"></div>
</div>
<!-- Spinner End -->


<!-- Navbar start -->
<div th:replace="~{/fragments/navbar :: navbar}"></div>
<!-- Navbar End -->


<!-- Modal Search Start -->
<div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content rounded-0">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Search by keyword</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body d-flex align-items-center">
                <div class="input-group w-75 mx-auto d-flex">
                    <input type="search" class="form-control p-3" placeholder="keywords" aria-describedby="search-icon-1">
                    <span id="search-icon-1" class="input-group-text p-3"><i class="fa fa-search"></i></span>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modal Search End -->

<!-- Toast container, centered at the bottom -->
<div class="toast-container">
    <!-- Success Toast -->
    <div id="toast" class="custom-toast hidden">
        <div>
            <span id="toast-message">Product added successfully!</span>
            <!-- <button class="close-btn" onclick="hideToast()">×</button>-->
        </div>
    </div>
</div>

<!-- Your shop content goes here -->
<script>
    function showToast() {
        const toast = document.getElementById('toast');
        setTimeout(() => {
            toast.classList.add('fade-out');
        }, 2000);

        setTimeout(() => {
            toast.classList.add('hidden');
        }, 3000);
    }

    // Function to manually close the toast
    function hideToast() {
        const toast = document.getElementById('toast');
        toast.classList.add('fade-out');

        setTimeout(() => {
            toast.classList.add('hidden');
        }, 800);
    }

    function checkForProductAdded() {
        const urlParams = new URLSearchParams(window.location.search);
        const productAdded = urlParams.get('productAdded');
        const error = urlParams.get('error');

        if (productAdded === 'true') {
            document.getElementById('toast').classList.remove('hidden');
            document.getElementById('toast-message').textContent = 'Product added successfully!';
            showToast();
        }

        if (error === 'fileTooLarge') {
            alert('The uploaded file is too large. Please select a file under 10MB.');
            window.location.href = '/addproduct';
        } else if (error === 'true') {
            alert('An error occurred while uploading the product.');
            window.location.href = '/addproduct';
        }
    }

    document.addEventListener('DOMContentLoaded', checkForProductAdded);

</script>

<!-- Single Page Header start -->
<div class="container-fluid page-header py-5">
    <h1 class="text-center text-white display-6">Recycle</h1>
    <ol class="breadcrumb justify-content-center mb-0">
        <li class="breadcrumb-item"><a href="#">Home</a></li>
        <li class="breadcrumb-item"><a href="#">Pages</a></li>
        <li class="breadcrumb-item active text-white">Recycle</li>
    </ol>
</div>
<!-- Single Page Header End -->

<!-- Fruits Shop Start-->
<div class="container-fluid fruite py-5">
    <div class="container py-5">
        <h1 class="mb-4">Recyclable materials</h1>
        <div class="row g-4">
            <div class="col-lg-12">
                <div class="row g-4">
                    <div class="col-xl-3">
                        <div class="input-group w-100 mx-auto d-flex">
                            <input type="search" class="form-control p-3" placeholder="keywords" aria-describedby="search-icon-1">
                            <span id="search-icon-1" class="input-group-text p-3"><i class="fa fa-search"></i></span>
                        </div>
                    </div>
                    <div class="col-6"></div>
                </div>
                <div class="row g-4">
                    <div class="col-lg-3">
                        <div class="row g-4">
                            <div class="col-lg-12">
                                <div class="mb-3">
                                    <br>
                                    <h4>Categories</h4>
                                    <ul class="list-unstyled fruite-categorie">
                                        <li>
                                            <div class="d-flex justify-content-between fruite-name">
                                                <a th:href="@{/shop(category='', minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${currentSort}, region=${currentRegion})}"
                                                   th:classappend="${currentCategory == ''} ? 'active-category'">
                                                    <img src="img/leaf.png" alt="leaf" class="me-2" style="width: 16px; height: 16px;">All Products
                                                </a>
                                                <span th:text="${totalProducts}"></span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="d-flex justify-content-between fruite-name">
                                                <a th:href="@{/shop(category='Metals', minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${currentSort}, region=${currentRegion})}"
                                                   th:classappend="${currentCategory == 'Metals'} ? 'active-category'">
                                                    <img src="img/leaf.png" alt="leaf" class="me-2" style="width: 16px; height: 16px;">Metals
                                                </a>
                                                <span th:text="${productCounts['Metals']}"></span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="d-flex justify-content-between fruite-name">
                                                <a th:href="@{/shop(category='Battery Recycling', minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${currentSort}, region=${currentRegion})}"
                                                   th:classappend="${currentCategory == 'Battery Recycling'} ? 'active-category'">
                                                    <img src="img/leaf.png" alt="leaf" class="me-2" style="width: 16px; height: 16px;">Battery Recycling
                                                </a>
                                                <span th:text="${productCounts['Battery Recycling']}"></span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="d-flex justify-content-between fruite-name">
                                                <a th:href="@{/shop(category='Compost & Food Waste', minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${currentSort}, region=${currentRegion})}"
                                                   th:classappend="${currentCategory == 'Compost & Food Waste'} ? 'active-category'">
                                                    <img src="img/leaf.png" alt="leaf" class="me-2" style="width: 16px; height: 16px;">Compost & Food Waste
                                                </a>
                                                <span th:text="${productCounts['Compost & Food Waste']}"></span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="d-flex justify-content-between fruite-name">
                                                <a th:href="@{/shop(category='Computer & Electronics', minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${currentSort}, region=${currentRegion})}"
                                                   th:classappend="${currentCategory == 'Computer & Electronics'} ? 'active-category'">
                                                    <img src="img/leaf.png" alt="leaf" class="me-2" style="width: 16px; height: 16px;">Computer & Electronics
                                                </a>
                                                <span th:text="${productCounts['Computer & Electronics']}"></span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="d-flex justify-content-between fruite-name">
                                                <a th:href="@{/shop(category='Glass & Fiberglass', minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${currentSort}, region=${currentRegion})}"
                                                   th:classappend="${currentCategory == 'Glass & Fiberglass'} ? 'active-category'">
                                                    <img src="img/leaf.png" alt="leaf" class="me-2" style="width: 16px; height: 16px;">Glass & Fiberglass
                                                </a>
                                                <span th:text="${productCounts['Glass & Fiberglass']}"></span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="d-flex justify-content-between fruite-name">
                                                <a th:href="@{/shop(category='Chemicals', minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${currentSort}, region=${currentRegion})}"
                                                   th:classappend="${currentCategory == 'Chemicals'} ? 'active-category'">
                                                    <img src="img/leaf.png" alt="leaf" class="me-2" style="width: 16px; height: 16px;">Chemicals
                                                </a>
                                                <span th:text="${productCounts['Chemicals']}"></span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="d-flex justify-content-between fruite-name">
                                                <a th:href="@{/shop(category='Paper/Cardboard', minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${currentSort}, region=${currentRegion})}"
                                                   th:classappend="${currentCategory == 'Paper/Cardboard'} ? 'active-category'">
                                                    <img src="img/leaf.png" alt="leaf" class="me-2" style="width: 16px; height: 16px;">Paper/Cardboard
                                                </a>
                                                <span th:text="${productCounts['Paper/Cardboard']}"></span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="d-flex justify-content-between fruite-name">
                                                <a th:href="@{/shop(category='Plastic', minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${currentSort}, region=${currentRegion})}"
                                                   th:classappend="${currentCategory == 'Plastic'} ? 'active-category'">
                                                    <img src="img/leaf.png" alt="leaf" class="me-2" style="width: 16px; height: 16px;">Plastic
                                                </a>
                                                <span th:text="${productCounts['Plastic']}"></span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="d-flex justify-content-between fruite-name">
                                                <a th:href="@{/shop(category='Textiles & Leather', minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${currentSort}, region=${currentRegion})}"
                                                   th:classappend="${currentCategory == 'Textiles & Leather'} ? 'active-category'">
                                                    <img src="img/leaf.png" alt="leaf" class="me-2" style="width: 16px; height: 16px;">Textiles & Leather
                                                </a>
                                                <span th:text="${productCounts['Textiles & Leather']}"></span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="d-flex justify-content-between fruite-name">
                                                <a th:href="@{/shop(category='Tire & Rubber', minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${currentSort}, region=${currentRegion})}"
                                                   th:classappend="${currentCategory == 'Tire & Rubber'} ? 'active-category'">
                                                    <img src="img/leaf.png" alt="leaf" class="me-2" style="width: 16px; height: 16px;">Tire & Rubber
                                                </a>
                                                <span th:text="${productCounts['Tire & Rubber']}"></span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="d-flex justify-content-between fruite-name">
                                                <a th:href="@{/shop(category='Wood', minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${currentSort}, region=${currentRegion})}"
                                                   th:classappend="${currentCategory == 'Wood'} ? 'active-category'">
                                                    <img src="img/leaf.png" alt="leaf" class="me-2" style="width: 16px; height: 16px;">Wood
                                                </a>
                                                <span th:text="${productCounts['Wood']}"></span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="d-flex justify-content-between fruite-name">
                                                <a th:href="@{/shop(category='Used Commercial Goods', minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${currentSort}, region=${currentRegion})}"
                                                   th:classappend="${currentCategory == 'Used Commercial Goods'} ? 'active-category'">
                                                    <img src="img/leaf.png" alt="leaf" class="me-2" style="width: 16px; height: 16px;">Used Commercial Goods
                                                </a>
                                                <span th:text="${productCounts['Used Commercial Goods']}"></span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="d-flex justify-content-between fruite-name">
                                                <a th:href="@{/shop(category='Used Clothes', minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${currentSort}, region=${currentRegion})}"
                                                   th:classappend="${currentCategory == 'Used Clothes'} ? 'active-category'">
                                                    <img src="img/leaf.png" alt="leaf" class="me-2" style="width: 16px; height: 16px;">Used Clothes
                                                </a>
                                                <span th:text="${productCounts['Used Clothes']}"></span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="d-flex justify-content-between fruite-name">
                                                <a th:href="@{/shop(category='Used Equipment', minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${currentSort}, region=${currentRegion})}"
                                                   th:classappend="${currentCategory == 'Used Equipment'} ? 'active-category'">
                                                    <img src="img/leaf.png" alt="leaf" class="me-2" style="width: 16px; height: 16px;">Used Equipment
                                                </a>
                                                <span th:text="${productCounts['Used Equipment']}"></span>
                                            </div>
                                        </li>
                                    </ul>


                                </div>
                            </div>

                            <div class="col-lg-12">
                                <div class="mb-3">
                                    <h4 class="mb-2">Price</h4>
                                    <div class="row">
                                        <div class="col-6">
                                            <a th:href="@{/shop(minPrice=0, maxPrice=50, sort=${currentSort}, category=${currentCategory}, region=${currentRegion})}"
                                               th:classappend="${minPrice == 0 and maxPrice == 50} ? 'active-price-filter' : ''"
                                               class="text-muted price-filter-link">
                                                Less than 50 MDL
                                            </a>
                                        </div>
                                        <div class="col-6">
                                            <a th:href="@{/shop(minPrice=50, maxPrice=100, sort=${currentSort}, category=${currentCategory}, region=${currentRegion})}"
                                               th:classappend="${minPrice == 50 and maxPrice == 100} ? 'active-price-filter' : ''"
                                               class="text-muted price-filter-link">
                                                50 - 100 MDL
                                            </a>
                                        </div>
                                        <div class="col-6">
                                            <a th:href="@{/shop(minPrice=100, maxPrice=250, sort=${currentSort}, category=${currentCategory}, region=${currentRegion})}"
                                               th:classappend="${minPrice == 100 and maxPrice == 250} ? 'active-price-filter' : ''"
                                               class="text-muted price-filter-link">
                                                100 - 250 MDL</a>
                                        </div>
                                        <div class="col-6">
                                            <a th:href="@{/shop(minPrice=250, maxPrice=500, sort=${currentSort}, category=${currentCategory}, region=${currentRegion})}"
                                               th:classappend="${minPrice == 250 and maxPrice == 500} ? 'active-price-filter' : ''"
                                               class="text-muted price-filter-link">
                                                250 - 500 MDL
                                            </a>
                                        </div>

                                        <div class="col-6">
                                            <a th:href="@{/shop(minPrice=500, maxPrice=750, sort=${currentSort}, category=${currentCategory}, region=${currentRegion})}"
                                               th:classappend="${minPrice == 500 and maxPrice == 750} ? 'active-price-filter' : ''"
                                               class="text-muted price-filter-link">
                                                500 - 750 MDL
                                            </a>
                                        </div>

                                        <div class="col-6">
                                            <a th:href="@{/shop(minPrice=750, maxPrice=1000, sort=${currentSort}, category=${currentCategory}, region=${currentRegion})}"
                                               th:classappend="${minPrice == 750 and maxPrice == 1000} ? 'active-price-filter' : ''"
                                               class="text-muted price-filter-link">
                                                750 - 1000 MDL
                                            </a>
                                        </div>

                                        <div class="col-6">
                                            <a th:href="@{/shop(minPrice=1000, maxPrice=5000, sort=${currentSort}, category=${currentCategory}, region=${currentRegion})}"
                                               th:classappend="${minPrice == 1000 and maxPrice == 5000} ? 'active-price-filter' : ''"
                                               class="text-muted price-filter-link">
                                                1000 - 5000 MDL
                                            </a>
                                        </div>

                                        <div class="col-6">
                                            <a th:href="@{/shop(minPrice=${minPrice}, maxPrice=5000, sort=${currentSort}, category=${currentCategory}, region=${currentRegion})}"
                                               th:classappend="${minPrice > 5000} ? 'active-price-filter' : ''"
                                               class="text-muted price-filter-link">
                                                More than 5000 MDL
                                            </a>
                                        </div>
                                    </div>

                                    <!-- Custom Price Filter -->
                                    <div class="d-flex align-items-center mt-3">
                                        <span>From</span>
                                        <input type="number" class="form-control mx-2" id="minPrice" name="minPrice" placeholder="0" min="0">
                                        <span>To</span>
                                        <input type="number" class="form-control mx-2" id="maxPrice" name="maxPrice" placeholder="5000" min="0">
                                        <span>MDL</span>
                                    </div>

                                    <div class="mt-2">
                                        <a href="#" onclick="applyPriceFilter()" class="btn-recycle btn border border-secondary d-flex align-items-center me-3 d-flex align-items-center justify-content-center">
                                            Filter
                                        </a>
                                    </div>

                                </div>
                            </div>

                            <div class="col-lg-12">
                                <div class="mb-3">
                                    <h4 class="mb-2">Regions</h4>
                                    <div class="row">
                                        <div class="col-12">
                                            <select id="regionFilter" class="form-control" onchange="applyRegionFilter()">
                                                <option value="">All Regions</option>
                                                <option value="Chișinău" th:selected="${currentRegion == 'Chișinău'}">Chișinău</option>
                                                <option value="Bălți" th:selected="${currentRegion == 'Bălți'}">Bălți</option>
                                                <option value="Tighina" th:selected="${currentRegion == 'Tighina'}">Tighina</option>
                                                <option value="Tiraspol" th:selected="${currentRegion == 'Tiraspol'}">Tiraspol</option>
                                                <option value="Comrat" th:selected="${currentRegion == 'Comrat'}">Comrat</option>
                                                <option value="Anenii Noi" th:selected="${currentRegion == 'Anenii Noi'}">Anenii Noi</option>
                                                <option value="Basarabeasca" th:selected="${currentRegion == 'Basarabeasca'}">Basarabeasca</option>
                                                <option value="Briceni" th:selected="${currentRegion == 'Briceni'}">Briceni</option>
                                                <option value="Cahul" th:selected="${currentRegion == 'Cahul'}">Cahul</option>
                                                <option value="Cantemir" th:selected="${currentRegion == 'Cantemir'}">Cantemir</option>
                                                <option value="Călărași" th:selected="${currentRegion == 'Călărași'}">Călărași</option>
                                                <option value="Căușeni" th:selected="${currentRegion == 'Căușeni'}">Căușeni</option>
                                                <option value="Cimișlia" th:selected="${currentRegion == 'Cimișlia'}">Cimișlia</option>
                                                <option value="Criuleni" th:selected="${currentRegion == 'Criuleni'}">Criuleni</option>
                                                <option value="Dondușeni" th:selected="${currentRegion == 'Dondușeni'}">Dondușeni</option>
                                                <option value="Drochia" th:selected="${currentRegion == 'Drochia'}">Drochia</option>
                                                <option value="Dubăsari" th:selected="${currentRegion == 'Dubăsari'}">Dubăsari</option>
                                                <option value="Edineț" th:selected="${currentRegion == 'Edineț'}">Edineț</option>
                                                <option value="Fălești" th:selected="${currentRegion == 'Fălești'}">Fălești</option>
                                                <option value="Florești" th:selected="${currentRegion == 'Florești'}">Florești</option>
                                                <option value="Glodeni" th:selected="${currentRegion == 'Glodeni'}">Glodeni</option>
                                                <option value="Hîncești" th:selected="${currentRegion == 'Hîncești'}">Hîncești</option>
                                                <option value="Ialoveni" th:selected="${currentRegion == 'Ialoveni'}">Ialoveni</option>
                                                <option value="Leova" th:selected="${currentRegion == 'Leova'}">Leova</option>
                                                <option value="Nisporeni" th:selected="${currentRegion == 'Nisporeni'}">Nisporeni</option>
                                                <option value="Ocnița" th:selected="${currentRegion == 'Ocnița'}">Ocnița</option>
                                                <option value="Orhei" th:selected="${currentRegion == 'Orhei'}">Orhei</option>
                                                <option value="Rezina" th:selected="${currentRegion == 'Rezina'}">Rezina</option>
                                                <option value="Rîșcani" th:selected="${currentRegion == 'Rîșcani'}">Rîșcani</option>
                                                <option value="Sîngerei" th:selected="${currentRegion == 'Sîngerei'}">Sîngerei</option>
                                                <option value="Soroca" th:selected="${currentRegion == 'Soroca'}">Soroca</option>
                                                <option value="Strășeni" th:selected="${currentRegion == 'Strășeni'}">Strășeni</option>
                                                <option value="Șoldănești" th:selected="${currentRegion == 'Șoldănești'}">Șoldănești</option>
                                                <option value="Ștefan Vodă" th:selected="${currentRegion == 'Ștefan Vodă'}">Ștefan Vodă</option>
                                                <option value="Taraclia" th:selected="${currentRegion == 'Taraclia'}">Taraclia</option>
                                                <option value="Telenești" th:selected="${currentRegion == 'Telenești'}">Telenești</option>
                                                <option value="Ungheni" th:selected="${currentRegion == 'Ungheni'}">Ungheni</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <script>
                                function applyPriceFilter() {
                                    const urlParams = new URLSearchParams(window.location.search);
                                    const minPrice = document.getElementById('minPrice').value || 0;
                                    const maxPrice = document.getElementById('maxPrice').value || 5000;

                                    urlParams.set('minPrice', minPrice);
                                    urlParams.set('maxPrice', maxPrice);

                                    window.location.search = urlParams.toString();
                                }

                                function applyRegionFilter() {
                                    const urlParams = new URLSearchParams(window.location.search);
                                    const selectedRegion = document.getElementById("regionFilter").value;

                                    if (selectedRegion) {
                                        urlParams.set('region', selectedRegion);
                                    } else {
                                        urlParams.delete('region');
                                    }

                                    window.location.search = urlParams.toString();
                                }

                                function applySort() {
                                    const urlParams = new URLSearchParams(window.location.search);
                                    const sortOrder = document.getElementById('sortFilter').value;

                                    urlParams.set('sort', sortOrder);

                                    window.location.search = urlParams.toString();
                                }
                            </script>

                            <div class="col-lg-12">
                                <div class="position-relative">
                                    <img src="img/banner-fruits.jpg" class="img-fluid w-100 rounded" alt="">
                                    <div class="position-absolute" style="top: 50%; right: 10px; transform: translateY(-50%);">

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-9" >
                        <!-- Container for the sort dropdown with margin for spacing -->
                        <div class="d-flex justify-content-end mb-3">
                            <div class="sort-dropdown-container">
                                <select id="sortFilter" class="form-control" onchange="applySort()" style="width: auto;">
                                    <option value="">Sort</option>
                                    <option value="priceAsc" th:selected="${currentSort == 'priceAsc'}">Price Low to High</option>
                                    <option value="priceDesc" th:selected="${currentSort == 'priceDesc'}">Price High to Low</option>
                                    <option value="dateAsc" th:selected="${currentSort == 'dateAsc'}">Date Oldest First</option>
                                    <option value="dateDesc" th:selected="${currentSort == 'dateDesc'}">Date Newest First</option>
                                </select>
                            </div>
                        </div>


                        <div class="row g-4 justify-content-center">
                            <!-- Dynamic product listing starts here -->
                            <div th:each="product : ${products}" class="col-md-6 col-lg-6 col-xl-4">
                                <div class="rounded position-relative fruite-item">
                                    <div class="fruite-img">
                                        <img th:src="@{'data:image/jpeg;base64,' + ${product.base64Image}}" class="img-fluid w-100 rounded-top" alt="Product Image">
                                    </div>
                                    <div class="text-white bg-secondary px-3 py-1 rounded position-absolute" style="top: 10px; left: 10px;">
                                        <span th:text="${product.category.categoryName}">Category</span>
                                    </div>
                                    <div class="p-4 border border-secondary border-top-0 rounded-bottom">
                                        <h4 th:text="${product.title}">Product Title</h4>
                                        <!-- Add poster username linked to their profile -->
                                        <p class="text-muted">
                                            Posted by: <a th:href="@{/profile/{username}(username=${product.user.username})}" th:text="${product.user.username}">Username</a>
                                        </p>
                                        <p class="product-description" th:text="${product.description}">Product Description</p>
                                        <div class="d-flex justify-content-between flex-lg-wrap">
                                            <p class="text-dark fs-5 fw-bold mb-0"><span th:text="${product.price} + ' MDL'">0.00</span></p>
                                            <a th:href="@{/addToCart}"
                                               th:data-id="${product.id}"
                                               th:data-title="${product.title}"
                                               th:data-quantity="${product.quantity}"
                                               th:data-description="${product.description}"
                                               th:data-price="${product.price}"
                                               th:data-image="${product.base64Image}"
                                               th:data-username="${product.user.username}"
                                               class="btn border border-secondary rounded-pill px-3 text-primary to-cart-button">
                                                <i class="fa fa-shopping-bag me-2 text-primary"></i> Add to cart
                                            </a>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Dynamic product listing ends here -->

                            <script>
                                document.querySelectorAll('.to-cart-button').forEach(button => {
                                    button.addEventListener('click', function(event) {
                                        event.preventDefault(); // Previne navigarea standard

                                        // Colectează informațiile produsului din atributele data-*
                                        const productInfo = {
                                            id: this.getAttribute('data-id'),
                                            title: this.getAttribute('data-title'),
                                            description: this.getAttribute('data-description'),
                                            quantity: this.getAttribute('data-quantity'),
                                            price: this.getAttribute('data-price'),
                                            image: this.getAttribute('data-image'),
                                            username: this.getAttribute('data-username')
                                        };

                                        // Trimiterea datelor la server prin cererea POST
                                        fetch('/addToCart', {
                                            method: 'POST',
                                            headers: {
                                                'Content-Type': 'application/json',
                                            },
                                            body: JSON.stringify(productInfo)
                                        })
                                            .then(response => response.json())
                                            .then(data => {
                                                console.log('Response:', data);
                                                // Aici poți adăuga logică pentru a actualiza UI-ul, cum ar fi afișarea unui mesaj de succes
                                            })
                                    });
                                });

                            </script>

                            <!-- Check if there are no products -->
                            <div th:if="${products.isEmpty()}">
                                <p class="text-center">No products found in this price range. Please adjust your filter criteria.</p>
                            </div>

                            <!-- Pagination -->
                            <div th:if="${!products.isEmpty()}" class="col-12">
                                <div class="pagination d-flex justify-content-center mt-5">
                                    <!-- Previous Page Link -->
                                    <a th:href="@{/shop(page=${currentPage - 1}, sort=${currentSort}, minPrice=${minPrice}, maxPrice=${maxPrice}, category=${currentCategory}, region=${currentRegion})}"
                                       th:if="${currentPage > 0}" class="rounded">&laquo;</a>

                                    <!-- Page Numbers -->
                                    <a th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                                       th:href="@{/shop(page=${i}, sort=${currentSort}, minPrice=${minPrice}, maxPrice=${maxPrice}, category=${currentCategory}, region=${currentRegion})}"
                                       th:text="${i + 1}"
                                       th:classappend="${i == currentPage} ? 'active' : ''"
                                       class="rounded"></a>

                                    <!-- Next Page Link -->
                                    <a th:href="@{/shop(page=${currentPage + 1}, sort=${currentSort}, minPrice=${minPrice}, maxPrice=${maxPrice}, category=${currentCategory}, region=${currentRegion})}"
                                       th:if="${currentPage < totalPages - 1}" class="rounded">&raquo;</a>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Fruits Shop End-->


        <!-- Navbar start -->
        <div th:replace="~{/fragments/about :: about}"></div>
        <!-- Navbar End -->

        <!-- Copyright Start -->
        <div class="container-fluid copyright bg-dark py-4">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                        <span class="text-light"><a href="#"><i class="fas fa-copyright text-light me-2"></i>Your Site Name</a>, All right reserved.</span>
                    </div>
                    <div class="col-md-6 my-auto text-center text-md-end text-white">
                        <!--/*** This template is free as long as you keep the below author’s credit link/attribution link/backlink. ***/-->
                        <!--/*** If you'd like to use the template without the below author’s credit link/attribution link/backlink, ***/-->
                        <!--/*** you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". ***/-->
                        Designed By <a class="border-bottom" href="https://htmlcodex.com">HTML Codex</a> Distributed By <a class="border-bottom" href="https://themewagon.com">ThemeWagon</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Copyright End -->



        <!-- Back to Top -->
        <a href="#" class="btn btn-primary border-3 border-primary rounded-circle back-to-top"><i class="fa fa-arrow-up"></i></a>   

        
    <!-- JavaScript Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/lightbox/js/lightbox.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>

<!-- Include Bootstrap JS and Popper.js -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Show the toast messages automatically
    document.addEventListener('DOMContentLoaded', function() {
        var toastElList = [].slice.call(document.querySelectorAll('.toast'))
        var toastList = toastElList.map(function(toastEl) {
            return new bootstrap.Toast(toastEl).show();
        });
    });
</script>

    </body>

</html>